<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<ui:composition template="/template/layout.xhtml" 
		xmlns:p="http://primefaces.org/ui"
		xmlns:ui="http://java.sun.com/jsf/facelets"
		xmlns:h="http://java.sun.com/jsf/html"
		xmlns:f="http://java.sun.com/jsf/core"
		xmlns:sh="http://java.sun.com/jsf/composite/components">
    <ui:define name="content">
    
    	<div class="well">
    		<h2>Shimmering constellations</h2>
    		<h:form id="basicSettingsForm">
	    		<p:outputLabel value="Project *.class files path:" styleClass="wide-label" />
	    		<p:inputText value="#{simulationController.properties.directoryPath}" size="100" />
	    		<p:commandLink styleClass="btn btn-primary btn-sm" 
	    				ajax="true" global="true"
						actionListener="#{simulationController.generateGraph}"
						update="@([id$=dataScript])" 
						onstart="ShimmerWeb.show('calculatingStatus');"
						oncomplete="ShimmerWeb.hide('calculatingStatus');Shimmer.reloadData();">
					<i class="glyphicon glyphicon-ok"></i>
				</p:commandLink>
    		</h:form>
    	</div>
    	
    	<div class="shimmerVisualisation panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Project visualiztion</h3>
			</div>
			<div class="panel-body">
			
			<p:outputPanel id="shimmerSimulation">
				
				<div id="shimmerContainer">
					<div id="shimmerHeatmap"></div>
					<div id="shimmerNetwork"></div>
					
					<sh:projectInformation />
				</div>
			
				<div id="shimmerPanel" class="panel panel-primary">
					<div class="panel-heading">
						Simulation <sh:calculatingIndicatior />
					</div>
					<div class="panel-body">
						<div>
							<button class="btn btn-success btn-sm width-half margin-bottom" 
								onclick="Shimmer.toggleHeatmap();">Change Mode</button>
						</div>
						<p:outputLabel value="Visualisation Mode: "/><span id="visualisationMode" class="label label-primary">Constellation Mode</span>

						<div>
							<h:form id="extraSettingsForm">
								<p:outputLabel for="sizeMetricField" value="Node size metric:" />
								<h:selectOneMenu id="sizeMetricField"
										value="#{simulationController.properties.nodeSizeMetric}">
									<f:selectItems value="#{enumSelectItemsProvider.metrics}" />
									<p:ajax event="change" global="true" 
										listener="#{simulationController.generateGraph}"
										update="@([id$=dataScript])" 
										onstart="ShimmerWeb.show('calculatingStatus');"
										oncomplete="ShimmerWeb.hide('calculatingStatus');Shimmer.reloadData();" />
								</h:selectOneMenu>
								
								<p:outputLabel for="colorMetricField" value="Node color metric:" />
								<h:selectOneMenu id="colorMetricField"
										value="#{simulationController.properties.nodeColorMetric}">
									<f:selectItems value="#{enumSelectItemsProvider.metrics}" />
									<p:ajax event="change" global="true" 
										listener="#{simulationController.generateGraph}"
										update="@([id$=dataScript])" 
										onstart="ShimmerWeb.show('calculatingStatus');"
										oncomplete="ShimmerWeb.hide('calculatingStatus');Shimmer.reloadData();" />
								</h:selectOneMenu>
								
								<p:outputLabel for="heatMetricField" value="Node heat metric:" />
								<h:selectOneMenu id="heatMetricField"
										value="#{simulationController.properties.nodeHeatMetric}">
									<f:selectItems value="#{enumSelectItemsProvider.metrics}" />
									<p:ajax event="change" global="true" 
										listener="#{simulationController.generateGraph}"
										update="@([id$=dataScript])" 
										onstart="ShimmerWeb.show('calculatingStatus');"
										oncomplete="ShimmerWeb.hide('calculatingStatus');Shimmer.reloadData();" />
								</h:selectOneMenu>
							</h:form>
						</div>
					</div>
				</div>
			
			</p:outputPanel>	
			</div>
		</div>
		
		<!-- This field is updated every time the data changes -->
		<p:outputPanel id="dataScript">
			<script type="text/javascript">
			/* <![CDATA[ */
			
				// Nodes and edges
				var nodes = #{simulationController.nodesJSON}
				var edges = #{simulationController.edgesJSON}
			    
				Shimmer.data = {
					nodes: nodes,
					edges: edges
				};
				
			/* ]]> */
			</script>
		</p:outputPanel>
		
		<!-- This is standard script field -->
		<script type="text/javascript">
		/* <![CDATA[ */
		
			// Simulation settings
			Shimmer.width = 800;
			Shimmer.height = 650;
			Shimmer.nodesCount = #{simulationController.nodesCount};

			// Create a network and heatmap
			Shimmer.networkContainer = document.getElementById('shimmerNetwork');
			Shimmer.heatmapContainer =  document.getElementById('shimmerHeatmap');
			Shimmer.createNetwork();
			Shimmer.createHeatmap();
			
			Shimmer.updateHeatmap();
		  
			// Assign listeners
			Shimmer.network.on('viewChanged', Shimmer.updateHeatmap);
			Shimmer.network.on('startStabilization', Shimmer.startUpdatingHeatmap);
			Shimmer.network.on('stabilized', Shimmer.stopUpdatingHeatmap);
			Shimmer.network.on('select', Shimmer.nodeSelectCallback);
			
			/* ]]> */
		</script>
    </ui:define>
</ui:composition>
</html>